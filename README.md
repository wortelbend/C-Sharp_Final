# PC 網路聊天室 (TCP/IP)

本專案為「視窗程式設計」課程的期末報告。

**組員:**
* B11170008
* B11170025

## 專案描述

這是一款使用 C# 和 Windows Forms 開發的點對點 (P2P) 網路聊天室應用程式。它允許兩位使用者透過 TCP/IP 協定在區域網路中進行一對一的即時通訊，包括文字訊息和圖片分享。

## 主要功能

*   **一對一文字聊天:** 支援即時文字訊息傳送與接收。
    *   訊息長度上限為 500 字元。
    *   發送方訊息以「我: 」開頭，接收方訊息以「對方: 」開頭。
    *   支援表情符號選擇與傳送。
    *   提供三個可自訂的預設訊息快速發送按鈕。
*   **圖片分享:**
    *   **傳送圖片:**
        *   可從本機選擇圖片檔案 (支援 JPG, JPEG, PNG, GIF, BMP 格式，檔案大小上限 5MB)。
        *   可透過輸入圖片 URL 傳送網路圖片。
        *   傳送前有圖片預覽。
    *   **接收圖片:**
        *   接收由對方傳送的 Base64 編碼圖片或圖片 URL。
        *   若是圖片 URL，程式會自動下載圖片。
        *   在聊天視窗中顯示接收到的圖片。
    *   **圖片檢視器:**
        *   點擊聊天視窗中的圖片或「查看圖片」按鈕，可開啟獨立的圖片檢視器。
        *   支援圖片縮放 (滑鼠滾輪) 和平移 (滑鼠左鍵拖曳)。
        *   可將正在檢視的圖片儲存到本機。
*   **連線管理:**
    *   **伺服器端:**
        *   手動啟動監聽，可自訂 IP 位址與通訊埠號 (預設自動填入本機IP及通訊埠 8888)。
        *   等待客戶端連線 (有 30 秒超時)。
        *   當有客戶端請求連線時，伺服器使用者會收到提示，可選擇「接受」或「拒絕」該連線。
        *   一次僅能處理一個客戶端連線。接受一個客戶端後，伺服器將停止監聽新的連線請求，直到目前聊天結束且使用者手動重新啟動監聽。
        *   若伺服器已在與某客戶端通訊中，新的連線請求將被拒絕。
    *   **客戶端:**
        *   手動輸入伺服器的 IP 位址與通訊埠號進行連線。
        *   連線過程有 30 秒超時。
        *   成功連線後，等待伺服器發送接受確認 (有 10 秒超時)。
*   **中斷連線:** 雙方皆可主動中斷連線。中斷後，聊天視窗關閉，相關控制項禁用。

## 技術棧

*   **程式語言:** C#
*   **框架:** .NET Framework 4.7.2
*   **使用者介面:** Windows Forms
*   **網路協定:** TCP/IP (使用 `System.Net.Sockets.TcpClient` 和 `System.Net.Sockets.TcpListener`)
*   **開發環境:** Visual Studio

## 如何使用

### 前置準備

*   兩台在同一區域網路下的電腦 (或在本機測試可使用 `127.0.0.1` 作為 IP 位址)。
*   已安裝 .NET Framework 4.7.2 (或更高相容版本)。

### 伺服器端操作

1.  執行 `P2PServer/P2PServer/bin/Debug/P2PServer.exe` (或自行編譯專案)。
2.  **啟動監聽:**
    *   在「伺服器連線」視窗中，確認 IP 位址 (通常會自動填入本機 IPv4 位址) 和通訊埠號 (預設 8888)。
    *   點擊「開始監聽」按鈕。伺服器將開始等待客戶端連線請求 (30 秒內)。
3.  **接受連線:**
    *   當有客戶端嘗試連線時，會彈出對話框顯示客戶端 IP，詢問是否接受。
    *   點擊「是」接受連線，點擊「否」拒絕。
    *   一旦接受連線，聊天視窗將開啟，伺服器連線視窗會隱藏，並且伺服器將不再接受新的連線請求。
4.  **聊天:**
    *   在聊天視窗中輸入文字、傳送表情符號或圖片。
5.  **結束聊天:**
    *   點擊「斷開連接」按鈕或關閉聊天視窗。
    *   伺服器連線視窗會重新顯示，此時可再次點擊「開始監聽」以等待新的客戶端。

### 客戶端操作

1.  執行 `P2PChat/P2PChat/bin/Debug/P2PChat.exe` (或自行編譯專案)。
2.  **連線到伺服器:**
    *   在「客戶端連線」視窗中，輸入伺服器端設定的 IP 位址和通訊埠號。
    *   點擊「連線TCP」按鈕。程式將嘗試連線 (30 秒超時)。
3.  **等待接受:**
    *   連線成功後，等待伺服器使用者接受您的連線 (10 秒超時)。
    *   若伺服器接受，聊天視窗將開啟，客戶端連線視窗會隱藏。
4.  **聊天:**
    *   在聊天視窗中輸入文字、傳送表情符號或圖片。
5.  **結束聊天:**
    *   點擊「斷開連接」按鈕或關閉聊天視窗。
    *   客戶端連線視窗會重新顯示。

## 通訊協定簡述

程式內部使用特定的字串標籤來協調通訊：

*   `"<ACCEPT_CHAT>"`: 伺服器成功接受客戶端連線後發送此訊號。
*   `"<DISCONNECT>"`: 任一方斷開連線時發送此訊號。
*   `"<IMAGE>BASE64_ENCODED_STRING</IMAGE>"`: 用於傳輸 Base64 編碼後的圖片資料。
*   `"<IMAGE_URL>URL_STRING</IMAGE_URL>"`: 用於傳輸圖片的直接連結 (客戶端接收後會嘗試下載)。

所有文字訊息和上述標籤均使用 Unicode 編碼。

## 未來展望 (建議)

*   **多使用者聊天室:** 將架構擴展為支援多人同時在線的聊天室。
*   **檔案傳輸:** 除了圖片，增加對其他類型檔案 (如文件、音訊) 的傳輸支援。
*   **使用者狀態:** 顯示對方「正在輸入...」或「已讀」狀態。
*   **訊息加密:** 對傳輸的訊息內容進行加密，提高通訊安全性。
*   **離線訊息:** 允許使用者向離線的好友發送訊息，待對方上線後接收。
*   **設定檔儲存:** 將伺服器IP、埠號等常用設定儲存起來，方便下次使用。

---

**注意:** `Old_P2PChat` 資料夾為舊版專案，請忽略。
